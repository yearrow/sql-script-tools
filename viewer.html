<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°æ®åº“è¡¨ç»“æ„æŸ¥çœ‹å™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: #f5f7fa;
            color: #333;
            height: 100vh;
            overflow: hidden;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        /* å¤´éƒ¨ä¿¡æ¯ */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 100;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .header .info {
            font-size: 14px;
            opacity: 0.9;
        }

        /* å·¦ä¾§è¡¨åˆ—è¡¨ */
        .sidebar {
            width: 350px;
            background: white;
            border-right: 1px solid #e0e0e0;
            margin-top: 100px;
            overflow-y: auto;
            box-shadow: 2px 0 5px rgba(0,0,0,0.05);
        }

        .search-box {
            position: sticky;
            top: 0;
            background: white;
            padding: 15px;
            border-bottom: 2px solid #f0f0f0;
            z-index: 10;
        }

        .search-box input {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .search-box input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .table-list {
            padding: 10px;
        }

        .table-item {
            padding: 12px 15px;
            margin: 5px 0;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }

        .table-item:hover {
            background: #f8f9ff;
            border-left-color: #667eea;
            transform: translateX(3px);
        }

        .table-item.active {
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
            border-left-color: #667eea;
            font-weight: bold;
        }

        .table-item .table-name {
            font-size: 14px;
            color: #333;
            margin-bottom: 3px;
        }

        .table-item .table-comment {
            font-size: 12px;
            color: #999;
        }

        /* å³ä¾§å†…å®¹åŒº */
        .content {
            flex: 1;
            padding: 120px 30px 30px 30px;
            overflow-y: auto;
        }

        .table-info {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }

        .table-info h2 {
            font-size: 22px;
            color: #667eea;
            margin-bottom: 10px;
        }

        .table-info .meta {
            color: #666;
            font-size: 14px;
            margin-bottom: 5px;
        }

        /* è¡¨æ ¼æ ·å¼ */
        .fields-table-wrapper {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        thead th {
            padding: 15px 12px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
            white-space: nowrap;
        }

        thead th:first-child {
            border-radius: 8px 0 0 0;
        }

        thead th:last-child {
            border-radius: 0 8px 0 0;
        }

        tbody tr {
            border-bottom: 1px solid #f0f0f0;
            transition: background 0.2s;
        }

        tbody tr:hover {
            background: #f8f9ff;
        }

        tbody td {
            padding: 12px;
            font-size: 13px;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .badge-primary {
            background: #667eea;
            color: white;
        }

        .badge-success {
            background: #48bb78;
            color: white;
        }

        .badge-danger {
            background: #f56565;
            color: white;
        }

        .badge-gray {
            background: #e0e0e0;
            color: #666;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state svg {
            width: 100px;
            height: 100px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        /* æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        /* å“åº”å¼ */
        @media (max-width: 768px) {
            .sidebar {
                width: 250px;
            }

            .content {
                padding: 120px 15px 15px 15px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ“Š æ•°æ®åº“è¡¨ç»“æ„æŸ¥çœ‹å™¨</h1>
        <div class="info">
            <span id="dbName">å½“å‰æ•°æ®åº“: -</span> |
            <span id="tableCount">è¡¨æ•°é‡: 0</span> |
            <span id="totalInfo">å…±0ä¸ªæ•°æ®åº“ï¼Œ0å¼ è¡¨</span>
        </div>
    </div>

    <div class="container">
        <!-- å·¦ä¾§è¡¨åˆ—è¡¨ -->
        <div class="sidebar">
            <div class="search-box">
                <select id="dbSelect" style="width: 100%; padding: 10px 15px; margin-bottom: 10px; border: 2px solid #667eea; border-radius: 8px; font-size: 14px; background: white; cursor: pointer;">
                    <option value="">é€‰æ‹©æ•°æ®åº“...</option>
                </select>
                <input type="text" id="searchInput" placeholder="ğŸ” æœç´¢è¡¨åæˆ–æ³¨é‡Š...">
            </div>
            <div class="table-list" id="tableList">
                <!-- è¡¨åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>

        <!-- å³ä¾§å†…å®¹åŒº -->
        <div class="content" id="content">
            <div class="empty-state">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
                <p>è¯·ä»å·¦ä¾§é€‰æ‹©ä¸€ä¸ªè¡¨æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</p>
            </div>
        </div>
    </div>

    <script>
        let allData = null;
        let currentDatabase = null;
        let filteredTables = [];

        // åŠ è½½JSONæ•°æ®
        async function loadData() {
            try {
                const response = await fetch('output.json');
                allData = await response.json();

                // æ›´æ–°å¤´éƒ¨ä¿¡æ¯
                document.getElementById('totalInfo').textContent =
                    `å…±${allData.totalDatabases}ä¸ªæ•°æ®åº“ï¼Œ${allData.totalTables}å¼ è¡¨`;

                // å¡«å……æ•°æ®åº“ä¸‹æ‹‰åˆ—è¡¨
                const dbSelect = document.getElementById('dbSelect');
                allData.databases.forEach((db, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = `${db.database} (${db.tables.length}å¼ è¡¨)`;
                    dbSelect.appendChild(option);
                });

                // é»˜è®¤é€‰æ‹©ç¬¬ä¸€ä¸ªæ•°æ®åº“
                if (allData.databases.length > 0) {
                    dbSelect.value = 0;
                    selectDatabase(0);
                }
            } catch (error) {
                console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
                alert('åŠ è½½æ•°æ®å¤±è´¥ï¼Œè¯·ç¡®ä¿ output.json æ–‡ä»¶å­˜åœ¨');
            }
        }

        // é€‰æ‹©æ•°æ®åº“
        function selectDatabase(index) {
            currentDatabase = allData.databases[index];

            // æ›´æ–°å¤´éƒ¨ä¿¡æ¯
            document.getElementById('dbName').textContent = `å½“å‰æ•°æ®åº“: ${currentDatabase.database}`;
            document.getElementById('tableCount').textContent = `è¡¨æ•°é‡: ${currentDatabase.tables.length}`;

            // é‡ç½®æœç´¢æ¡†
            document.getElementById('searchInput').value = '';

            filteredTables = currentDatabase.tables;
            renderTableList();

            // æ¸…ç©ºå³ä¾§å†…å®¹
            document.getElementById('content').innerHTML = `
                <div class="empty-state">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    <p>è¯·ä»å·¦ä¾§é€‰æ‹©ä¸€ä¸ªè¡¨æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</p>
                </div>
            `;
        }

        // æ¸²æŸ“è¡¨åˆ—è¡¨
        function renderTableList() {
            const tableListEl = document.getElementById('tableList');
            tableListEl.innerHTML = '';

            if (filteredTables.length === 0) {
                tableListEl.innerHTML = '<div style="padding: 20px; text-align: center; color: #999;">æœªæ‰¾åˆ°åŒ¹é…çš„è¡¨</div>';
                return;
            }

            filteredTables.forEach((table, index) => {
                const itemEl = document.createElement('div');
                itemEl.className = 'table-item';
                itemEl.innerHTML = `
                    <div class="table-name">${table.tableName}</div>
                    <div class="table-comment">${table.comment || 'æ— æ³¨é‡Š'}</div>
                `;
                itemEl.onclick = () => showTableDetail(table, itemEl);
                tableListEl.appendChild(itemEl);
            });
        }

        // æ˜¾ç¤ºè¡¨è¯¦æƒ…
        function showTableDetail(table, itemEl) {
            // æ›´æ–°é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.table-item').forEach(el => el.classList.remove('active'));
            itemEl.classList.add('active');

            // æ¸²æŸ“è¡¨è¯¦æƒ…
            const contentEl = document.getElementById('content');

            let html = `
                <div class="table-info">
                    <h2>${table.tableName}</h2>
                    <div class="meta">è¡¨æ³¨é‡Š: ${table.comment || 'æ— æ³¨é‡Š'}</div>
                    <div class="meta">å­—æ®µæ•°é‡: ${table.columns.length}</div>
                </div>

                <div class="fields-table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>å±æ€§å</th>
                                <th>å­—æ®µç±»å‹</th>
                                <th>å¯ç©ºçŠ¶æ€</th>
                                <th>ä¸»é”®</th>
                                <th>è¯´æ˜</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            table.columns.forEach(column => {
                const nullableText = column.nullable ?
                    '<span class="badge badge-success">å¯ç©º</span>' :
                    '<span class="badge badge-danger">ä¸å¯ç©º</span>';

                const primaryKeyText = column.isPrimaryKey ?
                    '<span class="badge badge-primary">ä¸»é”®</span>' :
                    '<span class="badge badge-gray">-</span>';

                html += `
                    <tr>
                        <td><strong>${column.name}</strong></td>
                        <td><code>${column.type}</code></td>
                        <td>${nullableText}</td>
                        <td>${primaryKeyText}</td>
                        <td>${column.comment || '-'}</td>
                    </tr>
                `;
            });

            html += `
                        </tbody>
                    </table>
                </div>
            `;

            contentEl.innerHTML = html;
        }

        // æ•°æ®åº“é€‰æ‹©äº‹ä»¶
        document.getElementById('dbSelect').addEventListener('change', (e) => {
            const index = parseInt(e.target.value);
            if (!isNaN(index)) {
                selectDatabase(index);
            }
        });

        // æœç´¢åŠŸèƒ½
        document.getElementById('searchInput').addEventListener('input', (e) => {
            const keyword = e.target.value.toLowerCase();

            if (!currentDatabase) return;

            if (!keyword) {
                filteredTables = currentDatabase.tables;
            } else {
                filteredTables = currentDatabase.tables.filter(table =>
                    table.tableName.toLowerCase().includes(keyword) ||
                    (table.comment && table.comment.toLowerCase().includes(keyword))
                );
            }

            renderTableList();
        });

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', loadData);
    </script>
</body>
</html>
